<Window x:Class="GpScanner.MainWindow" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Extensions="clr-namespace:Extensions;assembly=Extensions"
    xmlns:ViewModel="clr-namespace:GpScanner.ViewModel"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:twainctrl="clr-namespace:TwainControl;assembly=TwainControl" Title="Tarayıcı" d:Height="600"
    d:Width="800" UseLayoutRounding="True" WindowStartupLocation="CenterScreen"
    WindowState="Maximized" mc:Ignorable="d">
    <Window.Resources>
        <CollectionViewSource x:Key="Veriler" Source="{Binding Dosyalar}">
            <CollectionViewSource.SortDescriptions />
        </CollectionViewSource>
        <Extensions:SystemFileIconConverter x:Key="SystemFileIconConverter" />
    </Window.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <twainctrl:TwainCtrl x:Name="TwainCtrl" />
        <GroupBox Grid.Column="1" Header="DOSYA">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="300" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Viewbox Stretch="Fill">
                    <Calendar PreviewMouseUp="Calendar_PreviewMouseUp" DisplayDateEnd="{Binding Mode=OneWay, Source={x:Static sys:DateTime.Today}}" SelectedDate="{Binding SeçiliGün}" />
                </Viewbox>
                <UniformGrid Grid.Row="1" Columns="2">
                    <Button Command="{Binding ResetFilter}" Content="TÜMÜNÜ GÖR" />
                    <ToggleButton IsChecked="{Binding Path=ShowPdfPreview}" Content="PDF DOSYA ÖNİZLEME" />
                </UniformGrid>
                <ListBox Grid.Row="2" VirtualizingPanel.ScrollUnit="Pixel" VirtualizingPanel.CacheLengthUnit="Item" VirtualizingPanel.CacheLength="2,2" VirtualizingPanel.IsVirtualizingWhenGrouping="True" VirtualizingPanel.VirtualizationMode="Recycling"
                    d:ItemsSource="{d:SampleData ItemCount=5}"
                    IsSynchronizedWithCurrentItem="False"
                    ItemsSource="{Binding Mode=OneWay, Source={StaticResource Veriler}}">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel />
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <CheckBox VerticalContentAlignment="Center" IsChecked="{Binding Seçili}" IsEnabled="{Binding FileName, Mode=OneWay, Converter={StaticResource FileNamePdfCheckConverter}}"  VerticalAlignment="Center">
                                                <CheckBox.Style>
                                                    <Style TargetType="CheckBox">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Path=DataContext.ShowPdfPreview, RelativeSource={RelativeSource AncestorType=Window}}" Value="true">
                                                                <Setter Property="Content">
                                                                    <Setter.Value>
                                                                        <ContentControl Width="84" Height="117" Content="{Binding Path=FileName}">
                                                                            <ContentControl.ContentTemplate>
                                                                                <DataTemplate>
                                                                                    <ViewModel:PdfViewer PdfFilePath="{Binding DataContext, Converter={StaticResource FilePathMergeConverter}, RelativeSource={RelativeSource Mode=TemplatedParent}}"  Template="{StaticResource PdfViewerControlTemplate}" FirstPageThumbnail="True" ToolBarVisibility="Collapsed" />
                                                                                </DataTemplate>
                                                                            </ContentControl.ContentTemplate>
                                                                        </ContentControl>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </CheckBox.Style>
                                            </CheckBox>
                                            <Extensions:SplitButton d:Content="Dosya"
                                                Command="{Binding DataContext.WebAdreseGit, ElementName=TwainCtrl, Mode=OneWay}"
                                                CommandParameter="{Binding Path=FileName}" SplitContentPartIsEnabled="{Binding FileName, Mode=OneWay, Converter={StaticResource FileNamePdfCheckConverter}}"
                                                Content="{Binding Mode=OneWay, Path=FileName, Converter={StaticResource FileNameExtractConverter}}">
                                                <Extensions:SplitButton.InternalContent>
                                                    <Extensions:ResizablePanel Width="480" Height="360" MinWidth="480"
                                                        MinHeight="360">
                                                        <GroupBox>
                                                            <ContentControl Content="{Binding Path=FileName}" ContentTemplate="{DynamicResource PdfViewerTemplate}" />
                                                        </GroupBox>
                                                    </Extensions:ResizablePanel>
                                                </Extensions:SplitButton.InternalContent>
                                            </Extensions:SplitButton>
                                            <TextBlock VerticalAlignment="Center">
                                                <Hyperlink Command="{Binding DataContext.ExploreFile, ElementName=TwainCtrl, Mode=OneWay}" CommandParameter="{Binding Path=FileName}" TextDecorations="None">
                                                    <Image Width="32" Height="32">
                                                        <Image.Source>
                                                            <MultiBinding Converter="{StaticResource SystemFileIconConverter}">
                                                                <Binding Source="Shell32.dll" />
                                                                <Binding Source="4" />
                                                            </MultiBinding>
                                                        </Image.Source>
                                                    </Image>
                                                </Hyperlink>
                                            </TextBlock>
                                        </StackPanel>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
                <Button Grid.Row="3" Command="{Binding PdfBirleştir}" Content="İŞARETLİ PDFLERİ BİRLEŞTİR" />
            </Grid>
        </GroupBox>
    </Grid>
</Window>